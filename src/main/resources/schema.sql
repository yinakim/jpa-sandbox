/* 카테고리 */
CREATE TABLE IF NOT EXISTS CATEGORY
(
    CATEGORY_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    CATEGORY_NM VARCHAR(255),
    STORE_ID    VARCHAR(36) NOT NULL,
    DELETE_YN   VARCHAR(1)  NOT NULL DEFAULT 'N',

    CREATED_AT  TIMESTAMP,
    CREATED_BY  VARCHAR(255),
    MODIFIED_AT TIMESTAMP,
    MODIFIED_BY VARCHAR(255)
);
COMMENT ON TABLE CATEGORY IS '카테고리 테이블';

/* 상품 */
CREATE TABLE IF NOT EXISTS PRODUCT
(
    PRODUCT_ID  BIGINT AUTO_INCREMENT PRIMARY KEY,
    PRODUCT_CD  VARCHAR(20)  NOT NULL UNIQUE,
    PRODUCT_NM  VARCHAR(100) NOT NULL,
    PRICE       INT          NOT NULL,
    STORE_ID    VARCHAR(36)  NOT NULL,
    BG_COLOR    VARCHAR(20)  NOT NULL,
    TAX_YN      VARCHAR(1)   NOT NULL,

    CATEGORY_ID BIGINT       NOT NULL,
    DELETE_YN   VARCHAR(1)   NOT NULL DEFAULT 'N',

    CREATED_AT  TIMESTAMP,
    CREATED_BY  VARCHAR(255),
    MODIFIED_AT TIMESTAMP,
    MODIFIED_BY VARCHAR(255),

    CONSTRAINT FK_PRODUCT_CATEGORY FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY (CATEGORY_ID)
);
COMMENT ON TABLE PRODUCT IS '상품 테이블';
COMMENT ON COLUMN PRODUCT.PRODUCT_ID IS '상품ID(PK)';
COMMENT ON COLUMN PRODUCT.PRODUCT_CD IS '상품고유ID';


/* 상품 ID SEQ 자체관리 */
CREATE TABLE IF NOT EXISTS PRODUCT_CD_SEQ
(
--     PRODUCT_SEQ BIGINT AUTO_INCREMENT PRIMARY KEY
    PRODUCT_SEQ BIGINT PRIMARY KEY
);
COMMENT ON TABLE PRODUCT_CD_SEQ IS '상품고유아이디(EX. P00001) 생성용  SEQ 자체관리 테이블';


/* 옵션그룹 */
CREATE TABLE IF NOT EXISTS OPTION_GROUP
(
    OPTION_GRP_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    OPTION_GRP_NM VARCHAR(50) NOT NULL,
    DEPTH         INT         NOT NULL,
    PARENT_ID     BIGINT, /* todo. 처음 설계할 때 OptionGroup을 depth를 가진 계층구조로 설계하면서 parent_id를 만들었는데, 설계가 바뀌면서 필요없어졌는데 제거하지 않음 */
    PRODUCT_ID    BIGINT      NOT NULL,
    DELETE_YN     VARCHAR(1)  NOT NULL DEFAULT 'N',
    CREATED_AT    TIMESTAMP,
    CREATED_BY    VARCHAR(255),
    MODIFIED_AT   TIMESTAMP,
    MODIFIED_BY   VARCHAR(255),

    CONSTRAINT FK_OPTIONGROUP_PARENT FOREIGN KEY (PARENT_ID) REFERENCES OPTION_GROUP (OPTION_GRP_ID),
    CONSTRAINT FK_OPTIONGROUP_PRODUCT FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT (PRODUCT_ID) /* todo. PRODUCT.ID -> PRODUCT_ID 로 명칭변경사항 반영안됨 */
);
COMMENT ON TABLE OPTION_GROUP IS '옵션그룹 테이블';


/* 옵션 */
CREATE TABLE IF NOT EXISTS OPTION
(
    OPTION_ID   BIGINT AUTO_INCREMENT PRIMARY KEY,
    OPTION_NM   VARCHAR(50) NOT NULL,
    EXTRA_PRICE INT         NOT NULL,
    OPTION_GROUP_ID BIGINT NOT NULL, /* todo. FK 컬럼 추가(엔티티 연관관계는 맺어져있으나 DDL에 누락되어 추가함) */
    DELETE_YN   VARCHAR(1)  NOT NULL DEFAULT 'N',
    CREATED_AT  TIMESTAMP,
    CREATED_BY  VARCHAR(255),
    MODIFIED_AT TIMESTAMP,
    MODIFIED_BY VARCHAR(255),
    CONSTRAINT FK_OPTION_OPTION_GROUP FOREIGN KEY (OPTION_GROUP_ID) REFERENCES OPTION_GROUP (OPTION_GRP_ID)
);
COMMENT ON TABLE OPTION IS '옵션 테이블';

/* 상품-옵션 매핑 */
CREATE TABLE IF NOT EXISTS PRODUCT_OPTION_GROUP
(
    POG_ID          BIGINT AUTO_INCREMENT PRIMARY KEY,
    PRODUCT_ID      BIGINT  NOT NULL,
    OPTION_GROUP_ID BIGINT  NOT NULL,
    ACTIVE_YN       CHAR(1) NOT NULL DEFAULT 'N',
    DELETE_YN       CHAR(1) NOT NULL DEFAULT 'N',
    CREATED_BY      VARCHAR(255)     DEFAULT NULL,
    CREATED_AT      DATETIME         DEFAULT CURRENT_TIMESTAMP,
    MODIFIED_BY     VARCHAR(255)     DEFAULT NULL,
    MODIFIED_AT     DATETIME         DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT FK_PRODUCT_OPTION_GROUP_PRODUCT FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT (PRODUCT_ID),
    CONSTRAINT FK_PRODUCT_OPTION_GROUP_OPTION_GROUP FOREIGN KEY (OPTION_GROUP_ID) REFERENCES OPTION_GROUP (OPTION_GRP_ID)
);
COMMENT ON TABLE PRODUCT_OPTION_GROUP IS '상품-옵션 매핑 테이블';


/* 주문 */
CREATE TABLE IF NOT EXISTS ORDER_MASTER
(
    DELETE_YN        VARCHAR(1)   NOT NULL,
    DISCOUNT_AMOUNT  INTEGER,
    DISCOUNT_PERCENT INTEGER,
    DISCOUNT_PRICE   INTEGER      NOT NULL,
    DISCOUNT_VALUE   INTEGER,
    ORIGIN_PRICE     INTEGER      NOT NULL,
    TOTAL_PRICE      INTEGER      NOT NULL,
    CREATED_AT       TIMESTAMP(6) NOT NULL,
    MODIFIED_AT      TIMESTAMP(6) NOT NULL,
    ORDER_ID         BIGINT GENERATED BY DEFAULT AS IDENTITY,
    CREATED_BY       VARCHAR(50)  NOT NULL,
    MODIFIED_BY      VARCHAR(50)  NOT NULL,
    DISCOUNT_TYPE    ENUM ('AMOUNT','EMPTY','PERCENT'),
    PRIMARY KEY (ORDER_ID)
);
COMMENT ON TABLE ORDER_MASTER IS '주문 (최상위) 테이블';

/* 주문상품 */
CREATE TABLE IF NOT EXISTS ORDER_ITEM
(
    DELETE_YN     VARCHAR(1)   NOT NULL,
    ITEM_PRICE    INTEGER      NOT NULL,
    ITEM_QUANTITY INTEGER      NOT NULL CHECK (ITEM_QUANTITY >= 1),
    CREATED_AT    TIMESTAMP(6) NOT NULL,
    MODIFIED_AT   TIMESTAMP(6) NOT NULL,
    ORDER_ID      BIGINT       NOT NULL,
    ORDER_ITEM_ID BIGINT GENERATED BY DEFAULT AS IDENTITY,
    PRODUCT_ID    BIGINT,
    CREATED_BY    VARCHAR(50)  NOT NULL,
    MODIFIED_BY   VARCHAR(50)  NOT NULL,
    PRODUCT_NM    VARCHAR(100) NOT NULL,
    PRIMARY KEY (ORDER_ITEM_ID)
);
COMMENT ON TABLE ORDER_ITEM IS '주문항목(상품) 테이블';

/* 주문상품 옵션 */
CREATE TABLE IF NOT EXISTS ORDER_ITEM_OPTION
(
    EXTRA_PRICE          INTEGER      NOT NULL,
    CREATED_AT           TIMESTAMP(6) NOT NULL,
    MODIFIED_AT          TIMESTAMP(6) NOT NULL,
    OPTION_ID            BIGINT       NOT NULL,
    ORDER_ITEM_ID        BIGINT       NOT NULL,
    ORDER_ITEM_OPTION_ID BIGINT GENERATED BY DEFAULT AS IDENTITY,
    CREATED_BY           VARCHAR(50)  NOT NULL,
    MODIFIED_BY          VARCHAR(50)  NOT NULL,
    OPTION_NM            VARCHAR(50)  NOT NULL,
    PRIMARY KEY (ORDER_ITEM_OPTION_ID)
);
COMMENT ON TABLE ORDER_ITEM_OPTION IS '주문옵션 테이블';
